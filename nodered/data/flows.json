[
    {
        "id": "7abbcc07f2a69fdf",
        "type": "tab",
        "label": "MQTT to InfluxDB Flow",
        "disabled": false,
        "info": "Flow voor joystick en button data van MQTT naar InfluxDB",
        "env": []
    },
    {
        "id": "mqtt_broker",
        "type": "mqtt-broker",
        "name": "Local Mosquitto",
        "broker": "mqtt",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "0cd8b6f23c0f3e18",
        "type": "global-config",
        "env": [],
        "modules": {
            "node-red-contrib-influxdb": "0.7.0"
        }
    },
    {
        "id": "influx_config",
        "type": "influxdb",
        "hostname": "influxdb",
        "port": "8086",
        "protocol": "http",
        "database": "sensors",
        "name": "InfluxDB v2",
        "usetls": false,
        "tls": "",
        "influxdbVersion": "2.0",
        "url": "http://influxdb:8086",
        "timeout": "",
        "rejectUnauthorized": true
    },
    {
        "id": "62d66926ea102049",
        "type": "mqtt in",
        "z": "7abbcc07f2a69fdf",
        "name": "Joystick MQTT",
        "topic": "joystick",
        "qos": "0",
        "datatype": "json",
        "broker": "mqtt_broker",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 100,
        "wires": [
            [
                "b85759e7011c474d"
            ]
        ]
    },
    {
        "id": "b85759e7011c474d",
        "type": "function",
        "z": "7abbcc07f2a69fdf",
        "name": "Valideer Joystick data",
        "func": "// Parse JSON indien nodig\nlet data;\ntry {\n    if (typeof msg.payload === 'string') {\n        data = JSON.parse(msg.payload);\n    } else {\n        data = msg.payload;\n    }\n} catch (e) {\n    node.warn(\"Invalid JSON: \" + msg.payload);\n    return null;\n}\n\n// x en y moeten tussen -1 en 1 liggen\nif (typeof data.x !== 'number' || typeof data.y !== 'number') {\n    node.warn(\"Missing x or y values\");\n    return null;\n}\n\nif (data.x < -1 || data.x > 1 || data.y < -1 || data.y > 1) {\n    node.warn(\"Values out of range: x=\" + data.x + \", y=\" + data.y);\n    return null;\n}\n\n// Format voor InfluxDB\nmsg.payload = {\n    x: data.x,\n    y: data.y\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 100,
        "wires": [
            [
                "97582370c3afab8f",
                "f961dc6c5396835a"
            ]
        ]
    },
    {
        "id": "97582370c3afab8f",
        "type": "influxdb out",
        "z": "7abbcc07f2a69fdf",
        "influxdb": "influx_config",
        "name": "Naar InfluxDB sturen",
        "measurement": "joystick",
        "precision": "ms",
        "retentionPolicy": "",
        "database": "",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "Dectronics",
        "bucket": "controller",
        "x": 640,
        "y": 100,
        "wires": []
    },
    {
        "id": "f961dc6c5396835a",
        "type": "debug",
        "z": "7abbcc07f2a69fdf",
        "name": "Debug Joystick",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 60,
        "wires": []
    },
    {
        "id": "0aa56fc88d2ffaa3",
        "type": "mqtt in",
        "z": "7abbcc07f2a69fdf",
        "name": "Buttons MQTT",
        "topic": "buttons",
        "qos": "0",
        "datatype": "json",
        "broker": "mqtt_broker",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 200,
        "wires": [
            [
                "beda837bd5419891"
            ]
        ]
    },
    {
        "id": "beda837bd5419891",
        "type": "function",
        "z": "7abbcc07f2a69fdf",
        "name": "Valideer Knop Data",
        "func": "// Parse JSON indien nodig\nlet data;\ntry {\n    if (typeof msg.payload === 'string') {\n        data = JSON.parse(msg.payload);\n    } else {\n        data = msg.payload;\n    }\n} catch (e) {\n    node.warn(\"Invalid JSON: \" + msg.payload);\n    return null;\n}\n\n// Buttons moeten 0 of 1 zijn\nconst buttons = ['A', 'B', 'X', 'Y'];\nfor (let btn of buttons) {\n    if (data[btn] !== 0 && data[btn] !== 1) {\n        node.warn(\"Invalid button value for \" + btn + \": \" + data[btn]);\n        return null;\n    }\n}\n\n// Format voor InfluxDB als single object\nmsg.payload = {\n    A: data.A,\n    B: data.B,\n    X: data.X,\n    Y: data.Y\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 200,
        "wires": [
            [
                "8c457aef4645b9a4",
                "ef6765f9e19a193a"
            ]
        ]
    },
    {
        "id": "8c457aef4645b9a4",
        "type": "influxdb out",
        "z": "7abbcc07f2a69fdf",
        "influxdb": "influx_config",
        "name": "Naar InfluxDB sturen",
        "measurement": "buttons",
        "precision": "ms",
        "retentionPolicy": "",
        "database": "",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "Dectronics",
        "bucket": "controller",
        "x": 640,
        "y": 200,
        "wires": []
    },
    {
        "id": "ef6765f9e19a193a",
        "type": "debug",
        "z": "7abbcc07f2a69fdf",
        "name": "Debug Buttons",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 160,
        "wires": []
    }
]